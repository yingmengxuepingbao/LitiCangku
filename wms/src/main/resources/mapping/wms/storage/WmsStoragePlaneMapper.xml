<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.penghaisoft.wms.storagemanagement.model.dao.WmsStoragePlaneMapper">

	<!-- =========================================================== -->
	<!-- 定义resultMap                                                                                                                                                                             -->
	<!-- =========================================================== -->
	<resultMap id="wmsStoragePlaneMap" type="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
		<result property="storagePlaneId" column="storage_plane_id"/>
		<result property="warehouseCode" column="warehouse_code"/>
		<result property="areaCode" column="area_code"/>
		<result property="locationCode" column="location_code"/>
		<result property="locationAttr" column="location_attr"/>
		<result property="locationDesc" column="location_desc"/>
		<result property="goodsCode" column="goods_code"/>
		<result property="goodsName" column="goods_name"/>
		<result property="batchNo" column="batch_no"/>
		<result property="availableAmount" column="available_amount"/>
		<result property="lockAmount" column="lock_amount"/>
		<result property="userDefined1" column="user_defined1"/>
		<result property="userDefined2" column="user_defined2"/>
		<result property="userDefined3" column="user_defined3"/>
		<result property="userDefined4" column="user_defined4"/>
		<result property="userDefined5" column="user_defined5"/>
		<result property="createBy" column="create_by"/>
		<result property="gmtCreate" column="gmt_create"/>
		<result property="lastModifiedBy" column="last_modified_by"/>
		<result property="gmtModified" column="gmt_modified"/>
		<result property="activeFlag" column="active_flag"/>
	</resultMap>

	<!-- =========================================================== -->
	<!-- 一些公共变量设置                                                                                                                                                                             -->
	<!-- =========================================================== -->
	<!-- mysql 分页 -->
	<sql id="pagination_tail">
		top ((#{page.pageOffset} +1)* #{page.rows})
	</sql>
	<!-- mysql 查询总数 -->
	<sql id="count_Tail">
		select count(1) from
	</sql>

	<sql id="selectAllColumns">
		<![CDATA[
 			wms_storage_plane_.storage_plane_id
 			,wms_storage_plane_.warehouse_code
 			,wms_storage_plane_.area_code
 			,wms_storage_plane_.location_code
 			,wms_storage_plane_.location_attr
 			,wms_storage_plane_.location_desc
 			,wms_storage_plane_.goods_code
 			,wms_goods_.goods_name
 			,wms_storage_plane_.batch_no
 			,wms_storage_plane_.available_amount
 			,wms_storage_plane_.lock_amount
 			,wms_storage_plane_.user_defined1
 			,wms_storage_plane_.user_defined2
 			,wms_storage_plane_.user_defined3
 			,wms_storage_plane_.user_defined4
 			,wms_storage_plane_.user_defined5
 			,wms_storage_plane_.create_by
 			,wms_storage_plane_.gmt_create
 			,wms_storage_plane_.last_modified_by
 			,wms_storage_plane_.gmt_modified
 			,wms_storage_plane_.active_flag
		FROM
		wms_storage_plane wms_storage_plane_ left join wms_goods wms_goods_
		on wms_storage_plane_.goods_code = wms_goods_.goods_code and wms_goods_.active_flag = '1'
		]]>
	</sql>

	<sql id="where_fragement">
		where 1=1
		<if test="entity!=null">
			<if test="entity.storagePlaneId != null and entity.storagePlaneId !=''">
				<![CDATA[ and wms_storage_plane_.storage_plane_id LIKE CONCAT('%',#{entity.storagePlaneId},'%')]]>
			</if>
			<if test="entity.warehouseCode != null and entity.warehouseCode !=''">
				<![CDATA[ and wms_storage_plane_.warehouse_code LIKE CONCAT('%',#{entity.warehouseCode},'%')]]>
			</if>
			<if test="entity.areaCode != null and entity.areaCode !=''">
				<![CDATA[ and wms_storage_plane_.area_code LIKE CONCAT('%',#{entity.areaCode},'%')]]>
			</if>
			<if test="entity.locationCode != null and entity.locationCode !=''">
				<![CDATA[ and wms_storage_plane_.location_code LIKE CONCAT('%',#{entity.locationCode},'%')]]>
			</if>
			<if test="entity.locationAttr != null and entity.locationAttr !=''">
				<![CDATA[ and wms_storage_plane_.location_attr LIKE CONCAT('%',#{entity.locationAttr},'%')]]>
			</if>
			<if test="entity.locationDesc != null and entity.locationDesc !=''">
				<![CDATA[ and wms_storage_plane_.location_desc LIKE CONCAT('%',#{entity.locationDesc},'%')]]>
			</if>
			<if test="entity.goodsCode != null and entity.goodsCode !=''">
				<![CDATA[ and wms_storage_plane_.goods_code LIKE CONCAT('%',#{entity.goodsCode},'%')]]>
			</if>
			<if test="entity.batchNo != null and entity.batchNo !=''">
				<![CDATA[ and wms_storage_plane_.batch_no LIKE CONCAT('%',#{entity.batchNo},'%')]]>
			</if>
			<if test="entity.availableAmount != null and entity.availableAmount !=''">
				<![CDATA[ and wms_storage_plane_.available_amount LIKE CONCAT('%',#{entity.availableAmount},'%')]]>
			</if>
			<if test="entity.lockAmount != null and entity.lockAmount !=''">
				<![CDATA[ and wms_storage_plane_.lock_amount LIKE CONCAT('%',#{entity.lockAmount},'%')]]>
			</if>
			<if test="entity.userDefined1 != null and entity.userDefined1 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined1 LIKE CONCAT('%',#{entity.userDefined1},'%')]]>
			</if>
			<if test="entity.userDefined2 != null and entity.userDefined2 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined2 LIKE CONCAT('%',#{entity.userDefined2},'%')]]>
			</if>
			<if test="entity.userDefined3 != null and entity.userDefined3 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined3 LIKE CONCAT('%',#{entity.userDefined3},'%')]]>
			</if>
			<if test="entity.userDefined4 != null and entity.userDefined4 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined4 LIKE CONCAT('%',#{entity.userDefined4},'%')]]>
			</if>
			<if test="entity.userDefined5 != null and entity.userDefined5 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined5 LIKE CONCAT('%',#{entity.userDefined5},'%')]]>
			</if>
			<if test="entity.createBy != null and entity.createBy !=''">
				<![CDATA[ and wms_storage_plane_.create_by LIKE CONCAT('%',#{entity.createBy},'%')]]>
			</if>
			<if test="entity.gmtCreate != null">
				<![CDATA[ and wms_storage_plane_.gmt_create LIKE CONCAT('%',#{entity.gmtCreate},'%')]]>
			</if>
			<if test="entity.lastModifiedBy != null and entity.lastModifiedBy !=''">
				<![CDATA[ and wms_storage_plane_.last_modified_by LIKE CONCAT('%',#{entity.lastModifiedBy},'%')]]>
			</if>
			<if test="entity.gmtModified != null">
				<![CDATA[ and wms_storage_plane_.gmt_modified LIKE CONCAT('%',#{entity.gmtModified},'%')]]>
			</if>
			<if test="entity.activeFlag != null and entity.activeFlag !=''">
				<![CDATA[ and wms_storage_plane_.active_flag LIKE CONCAT('%',#{entity.activeFlag},'%')]]>
			</if>
		</if>
	</sql>

	<sql id="where_any">
		where 1=1
		<if test="entity!=null">
			<if test="entity.storagePlaneId != null and entity.storagePlaneId !=''">
				<![CDATA[ and wms_storage_plane_.storage_plane_id = #{entity.storagePlaneId}]]>
			</if>
			<if test="entity.warehouseCode != null and entity.warehouseCode !=''">
				<![CDATA[ and wms_storage_plane_.warehouse_code = #{entity.warehouseCode}]]>
			</if>
			<if test="entity.areaCode != null and entity.areaCode !=''">
				<![CDATA[ and wms_storage_plane_.area_code = #{entity.areaCode}]]>
			</if>
			<if test="entity.locationCode != null and entity.locationCode !=''">
				<![CDATA[ and wms_storage_plane_.location_code = #{entity.locationCode}]]>
			</if>
			<if test="entity.locationAttr != null and entity.locationAttr !=''">
				<![CDATA[ and wms_storage_plane_.location_attr = #{entity.locationAttr}]]>
			</if>
			<if test="entity.locationDesc != null and entity.locationDesc !=''">
				<![CDATA[ and wms_storage_plane_.location_desc = #{entity.locationDesc}]]>
			</if>
			<if test="entity.goodsCode != null and entity.goodsCode !=''">
				<![CDATA[ and wms_storage_plane_.goods_code = #{entity.goodsCode}]]>
			</if>
			<if test="entity.batchNo != null and entity.batchNo !=''">
				<![CDATA[ and wms_storage_plane_.batch_no = #{entity.batchNo}]]>
			</if>
			<if test="entity.availableAmount != null and entity.availableAmount !=''">
				<![CDATA[ and wms_storage_plane_.available_amount = #{entity.availableAmount}]]>
			</if>
			<if test="entity.lockAmount != null and entity.lockAmount !=''">
				<![CDATA[ and wms_storage_plane_.lock_amount = #{entity.lockAmount}]]>
			</if>
			<if test="entity.userDefined1 != null and entity.userDefined1 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined1 = #{entity.userDefined1}]]>
			</if>
			<if test="entity.userDefined2 != null and entity.userDefined2 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined2 = #{entity.userDefined2}]]>
			</if>
			<if test="entity.userDefined3 != null and entity.userDefined3 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined3 = #{entity.userDefined3}]]>
			</if>
			<if test="entity.userDefined4 != null and entity.userDefined4 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined4 = #{entity.userDefined4}]]>
			</if>
			<if test="entity.userDefined5 != null and entity.userDefined5 !=''">
				<![CDATA[ and wms_storage_plane_.user_defined5 = #{entity.userDefined5}]]>
			</if>
			<if test="entity.createBy != null and entity.createBy !=''">
				<![CDATA[ and wms_storage_plane_.create_by = #{entity.createBy}]]>
			</if>
			<if test="entity.gmtCreate != null">
				<![CDATA[ and wms_storage_plane_.gmt_create = #{entity.gmtCreate}]]>
			</if>
			<if test="entity.lastModifiedBy != null and entity.lastModifiedBy !=''">
				<![CDATA[ and wms_storage_plane_.last_modified_by = #{entity.lastModifiedBy}]]>
			</if>
			<if test="entity.gmtModified != null">
				<![CDATA[ and wms_storage_plane_.gmt_modified = #{entity.gmtModified}]]>
			</if>
			<if test="entity.activeFlag != null and entity.activeFlag !=''">
				<![CDATA[ and wms_storage_plane_.active_flag = #{entity.activeFlag}]]>
			</if>
		</if>
	</sql>

	<!-- =========================================================== -->
	<!-- DAO方法中的基本增删改查方法                                                                                                                                                           -->
	<!-- =========================================================== -->
	<!-- 根据id查询 -->
	<select id="queryById" resultMap="wmsStoragePlaneMap" parameterType="java.lang.String">
		select
		<include refid="selectAllColumns" />
		<![CDATA[
		where wms_storage_plane_.storage_plane_id = #{id}
		]]>
	</select>

	<!-- 分页查询 -->
	<select id="queryList" resultMap="wmsStoragePlaneMap" >
		select
		<if test="page!=null">
			<include refid="pagination_tail" />
		</if>
		<include refid="selectAllColumns"/>
		<include refid="where_fragement" />
		<if test="entity.orderBy != null and entity.orderBy !=''">
			order by ${entity.orderBy}
		</if>

	</select>



	<select id="queryCount" resultType="long">
		<include refid="count_Tail" />
		wms_storage_plane wms_storage_plane_
		<include refid="where_fragement" />
	</select>

	<!-- 插入记录 -->
	<insert id="create" parameterType="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
		<![CDATA[
		insert into wms_storage_plane (
		    	 storage_plane_id
		    	 ,warehouse_code
		    	 ,area_code
		    	 ,location_code
		    	 ,location_attr
		    	 ,location_desc
		    	 ,goods_code
		    	 ,batch_no
		    	 ,available_amount
		    	 ,lock_amount
		    	 ,user_defined1
		    	 ,user_defined2
		    	 ,user_defined3
		    	 ,user_defined4
		    	 ,user_defined5
		    	 ,create_by
		    	 ,gmt_create
		    	 ,last_modified_by
		    	 ,gmt_modified
		    	 ,active_flag
		   )values(
		    	#{storagePlaneId}
		    	,#{warehouseCode}
		    	,#{areaCode}
		    	,#{locationCode}
		    	,#{locationAttr}
		    	,#{locationDesc}
		    	,#{goodsCode}
		    	,#{batchNo}
		    	,#{availableAmount}
		    	,#{lockAmount}
		    	,#{userDefined1}
		    	,#{userDefined2}
		    	,#{userDefined3}
		    	,#{userDefined4}
		    	,#{userDefined5}
		    	,#{createBy}
		    	,#{gmtCreate}
		    	,#{lastModifiedBy}
		    	,#{gmtModified}
		    	,#{activeFlag}
		   )
	    ]]>
	</insert>

	<!-- 批量插入记录 -->
	<insert id="batchInsert" parameterType="java.util.List">
		insert into wms_storage_plane (
		storage_plane_id
		,warehouse_code
		,area_code
		,location_code
		,location_attr
		,location_desc
		,goods_code
		,batch_no
		,available_amount
		,lock_amount
		,user_defined1
		,user_defined2
		,user_defined3
		,user_defined4
		,user_defined5
		,create_by
		,gmt_create
		,last_modified_by
		,gmt_modified
		,active_flag
		)
		values
		<foreach collection="list" item="item" index="index" separator="," >
			(
			#{item.storagePlaneId}
			,#{item.warehouseCode}
			,#{item.areaCode}
			,#{item.locationCode}
			,#{item.locationAttr}
			,#{item.locationDesc}
			,#{item.goodsCode}
			,#{item.batchNo}
			,#{item.availableAmount}
			,#{item.lockAmount}
			,#{item.userDefined1}
			,#{item.userDefined2}
			,#{item.userDefined3}
			,#{item.userDefined4}
			,#{item.userDefined5}
			,#{item.createBy}
			,#{item.gmtCreate}
			,#{item.lastModifiedBy}
			,#{item.gmtModified}
			,#{item.activeFlag}
			)
		</foreach>
	</insert>

	<!-- 根据id，修改记录 -->
	<update id="update" parameterType="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
		<![CDATA[
		update wms_storage_plane set

   			warehouse_code = #{warehouseCode}
   			,area_code = #{areaCode}
   			,location_code = #{locationCode}
   			,location_attr = #{locationAttr}
   			,location_desc = #{locationDesc}
   			,goods_code = #{goodsCode}
   			,batch_no = #{batchNo}
   			,available_amount = #{availableAmount}
   			,lock_amount = #{lockAmount}
   			,user_defined1 = #{userDefined1}
   			,user_defined2 = #{userDefined2}
   			,user_defined3 = #{userDefined3}
   			,user_defined4 = #{userDefined4}
   			,user_defined5 = #{userDefined5}
   			,create_by = #{createBy}
   			,gmt_create = #{gmtCreate}
   			,last_modified_by = #{lastModifiedBy}
   			,gmt_modified = #{gmtModified}
   			,active_flag = #{activeFlag}
		 where storage_plane_id = #{storagePlaneId}
		]]>
	</update>

	<!--  -->
	<update id="updateBySelect" parameterType="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
		update wms_storage_plane <set>
		<if test="entity!=null">
			<if test="entity.storagePlaneId != null and entity.storagePlaneId !=''">

			</if>
			<if test="entity.warehouseCode != null and entity.warehouseCode !=''">
				<![CDATA[ warehouse_code = #{entity.warehouseCode}, ]]>
			</if>
			<if test="entity.areaCode != null and entity.areaCode !=''">
				<![CDATA[ area_code = #{entity.areaCode}, ]]>
			</if>
			<if test="entity.locationCode != null and entity.locationCode !=''">
				<![CDATA[ location_code = #{entity.locationCode}, ]]>
			</if>
			<if test="entity.locationAttr != null and entity.locationAttr !=''">
				<![CDATA[ location_attr = #{entity.locationAttr}, ]]>
			</if>
			<if test="entity.locationDesc != null and entity.locationDesc !=''">
				<![CDATA[ location_desc = #{entity.locationDesc}, ]]>
			</if>
			<if test="entity.goodsCode != null and entity.goodsCode !=''">
				<![CDATA[ goods_code = #{entity.goodsCode}, ]]>
			</if>
			<if test="entity.batchNo != null and entity.batchNo !=''">
				<![CDATA[ batch_no = #{entity.batchNo}, ]]>
			</if>
			<if test="entity.availableAmount != null">
				<![CDATA[ available_amount = #{entity.availableAmount}, ]]>
			</if>
			<if test="entity.lockAmount != null">
				<![CDATA[ lock_amount = #{entity.lockAmount}, ]]>
			</if>
			<if test="entity.userDefined1 != null and entity.userDefined1 !=''">
				<![CDATA[ user_defined1 = #{entity.userDefined1}, ]]>
			</if>
			<if test="entity.userDefined2 != null and entity.userDefined2 !=''">
				<![CDATA[ user_defined2 = #{entity.userDefined2}, ]]>
			</if>
			<if test="entity.userDefined3 != null and entity.userDefined3 !=''">
				<![CDATA[ user_defined3 = #{entity.userDefined3}, ]]>
			</if>
			<if test="entity.userDefined4 != null and entity.userDefined4 !=''">
				<![CDATA[ user_defined4 = #{entity.userDefined4}, ]]>
			</if>
			<if test="entity.userDefined5 != null and entity.userDefined5 !=''">
				<![CDATA[ user_defined5 = #{entity.userDefined5}, ]]>
			</if>
			<if test="entity.createBy != null and entity.createBy !=''">
				<![CDATA[ create_by = #{entity.createBy}, ]]>
			</if>
			<if test="entity.gmtCreate != null">
				<![CDATA[ gmt_create = #{entity.gmtCreate}, ]]>
			</if>
			<if test="entity.lastModifiedBy != null and entity.lastModifiedBy !=''">
				<![CDATA[ last_modified_by = #{entity.lastModifiedBy}, ]]>
			</if>
			<if test="entity.gmtModified != null">
				<![CDATA[ gmt_modified = #{entity.gmtModified}, ]]>
			</if>
			<if test="entity.activeFlag != null and entity.activeFlag !=''">
				<![CDATA[ active_flag = #{entity.activeFlag}, ]]>
			</if>
		</if>
	</set>
		where storage_plane_id = #{entity.storagePlaneId}
	</update>

	<!-- 逻辑删除,根据主键设置active_flag ='0' -->
	<update id="delete" parameterType="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
	    UPDATE wms_storage_plane
	    SET active_flag = "0"
	    ,last_modified_by = #{entity.lastModifiedBy}
	    ,gmt_modified = #{entity.gmtModified}
	     where storage_plane_id = #{entity.storagePlaneId}
	  </update>

	<update id="batchDelete" parameterType="com.penghaisoft.wms.storagemanagement.model.entity.WmsStoragePlane">
		DELETE FROM wms_storage_plane
		where storage_plane_id in
		<foreach collection="entity.storagePlaneIdList" index="index" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</update>

	<!-- 任意字段全匹配 -->
	<select id="queryByAny" resultMap="wmsStoragePlaneMap" >
		select
		<include refid="selectAllColumns"/>
		<include refid="where_any" />
	</select>

	<select id="queryByAnyCount" resultType="long">
		<include refid="count_Tail" />
		wms_storage_plane wms_storage_plane_
		<include refid="where_any" />
	</select>

	<select id="getAvailableGoods" resultMap="wmsStoragePlaneMap" >
		select
		<include refid="selectAllColumns"/>
		where wms_storage_plane_.available_amount >0
		and wms_storage_plane_.active_flag ="1"
		<if test="entity.goodsCode != null and entity.goodsCode !=''">
			<![CDATA[ and wms_storage_plane_.goods_code = #{entity.goodsCode} ]]>
		</if>
		GROUP BY
		wms_storage_plane_.goods_code
	</select>

	<select id="findBatchNo" resultMap="wmsStoragePlaneMap" >
		select distinct wms_storage_plane_.batch_no
		from wms_storage_plane wms_storage_plane_
		where wms_storage_plane_.available_amount >0
		and wms_storage_plane_.active_flag ="1"
		<if test="entity.goodsCode != null and entity.goodsCode !=''">
			<![CDATA[ and wms_storage_plane_.goods_code = #{entity.goodsCode} ]]>
		</if>
	</select>

	<select id="findLocation" resultMap="wmsStoragePlaneMap" >
		select
		<include refid="selectAllColumns"/>
		where wms_storage_plane_.available_amount >0
		and wms_storage_plane_.active_flag ="1"
		<if test="entity.goodsCode != null and entity.goodsCode !=''">
			<![CDATA[ and wms_storage_plane_.goods_code = #{entity.goodsCode} ]]>
		</if>
		<if test="entity.batchNo != null and entity.batchNo !=''">
			<![CDATA[ and wms_storage_plane_.batch_no = #{entity.batchNo} ]]>
		</if>
	</select>

	<select id="findAllLocation" resultMap="wmsStoragePlaneMap" >
		SELECT DISTINCT
			wms_storage_plane_.location_code
		FROM
			wms_storage_plane wms_storage_plane_
		WHERE
			wms_storage_plane_.active_flag = "1"
	</select>
</mapper>